@page "/Chat"
@model ChatModel
@{
    ViewData["Title"] = "Chat - CFD Penney";
    Layout = "_ChatLayout";
}

@section Head {
    @await Html.PartialAsync("Shared/_ChatHead")
}

@await Html.PartialAsync("Shared/_ChatHeader")

<div class="chat-container">
    @await Html.PartialAsync("Shared/_ChatConversationsList", Model)
    @await Html.PartialAsync("Shared/_ChatMessagesPanel", Model)
    @await Html.PartialAsync("Shared/_ChatDetailsPanel", Model)
</div>

@section Scripts {
    @{
        var selectedConvId = Model.SelectedConversation?.Id ?? "";
        var usersJson = Model.AllUsers != null && Model.AllUsers.Any()
            ? System.Text.Json.JsonSerializer.Serialize(Model.AllUsers.Select(u => new { u.Id, u.Username, u.DisplayName }))
            : "[]";
    }
    <script>
        // Pass server data to JavaScript for SignalR updates
        window.currentUserId = '@Html.Raw(Model.CurrentUserId ?? "")';
        window.currentUserName = '@Html.Raw(Model.CurrentUserName ?? "")';
        window.currentUserDisplayName = '@Html.Raw(Model.CurrentUserDisplayName ?? "")';
        window.selectedConversationId = '@Html.Raw(selectedConvId)';
        window.allUsers = @Html.Raw(usersJson);
    </script>
    <script type="module" src="~/js/chat/chatPage.js"></script>
}
