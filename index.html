<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="CFD Penney - Turn any screen into a collaborative canvas. Free real-time whiteboard and screen annotation tool for Windows, macOS & Linux. No account required, instant collaboration.">
    <meta name="keywords" content="collaborative whiteboard, screen annotation, real-time drawing, online whiteboard, screen sharing, annotation tool, collaborative drawing, virtual whiteboard, free whiteboard, team collaboration, remote collaboration, annotation software, desktop annotation">
    <meta name="author" content="CodeFryDev">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://codefrydev.in/CFDPenney/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://codefrydev.in/CFDPenney/">
    <meta property="og:title" content="CFD Penney - Turn Any Screen Into a Collaborative Canvas">
    <meta property="og:description" content="Free real-time whiteboard and screen annotation tool for Windows, macOS & Linux. Draw over any app, collaborate with remote teams, and brainstorm on an infinite canvas. No account required.">
    <meta property="og:image" content="https://codefrydev.in/CFDPenney/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:site_name" content="CFD Penney">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://codefrydev.in/CFDPenney/">
    <meta name="twitter:title" content="CFD Penney - Turn Any Screen Into a Collaborative Canvas">
    <meta name="twitter:description" content="Free real-time whiteboard and screen annotation tool for Windows, macOS & Linux. Draw over any app, collaborate with remote teams, and brainstorm on an infinite canvas. No account required.">
    <meta name="twitter:image" content="https://codefrydev.in/CFDPenney/og-image.jpg">
    <meta name="twitter:image:alt" content="CFD Penney - Collaborative Screen Annotation and Whiteboard Tool">
    
    <title>CFD Penney - Real-time Whiteboard & Screen Annotation</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <link rel="shortcut icon" href="favicon-32x32.png">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/landing-main.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- JSON-LD Structured Data -->
    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "@id": "https://codefrydev.in/#organization",
      "name": "CodeFryDev",
      "url": "https://codefrydev.in/",
      "logo": "https://codefrydev.in/CFDPenney/og-image.jpg",
      "sameAs": [
        "https://github.com/codefrydev/CFDPenney"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "support"
      }
    }
    </script>
    
    <!-- WebSite Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "@id": "https://codefrydev.in/CFDPenney/#website",
      "name": "CFD Penney",
      "url": "https://codefrydev.in/CFDPenney/",
      "description": "Real-time collaborative whiteboard and screen annotation tool. Turn any screen into a collaborative canvas.",
      "publisher": {
        "@id": "https://codefrydev.in/#organization"
      },
      "inLanguage": "en-US"
    }
    </script>
    
    <!-- SoftwareApplication Schema (Desktop App) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "@id": "https://codefrydev.in/CFDPenney/#desktopapp",
      "name": "CFD Penney Desktop",
      "operatingSystem": ["Windows", "macOS", "Linux"],
      "applicationCategory": "CollaborationApplication",
      "description": "Desktop application for screen annotation overlay and collaborative whiteboard. Draw over any app with real-time collaboration.",
      "url": "https://github.com/codefrydev/CFDPenney/",
      "downloadUrl": "https://github.com/codefrydev/CFDPenney/",
      "softwareVersion": "1.0",
      "author": {
        "@id": "https://codefrydev.in/#organization"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD",
        "availability": "https://schema.org/InStock"
      },
      "featureList": [
        "Screen annotation overlay",
        "Real-time collaboration via WebRTC",
        "Virtual whiteboard mode",
        "Code-based session joining",
        "No account required",
        "Cross-platform support",
        "Free and open source"
      ],
      "screenshot": "https://codefrydev.in/CFDPenney/og-image.jpg"
    }
    </script>
    
    <!-- Product Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Product",
      "@id": "https://codefrydev.in/CFDPenney/#product",
      "name": "CFD Penney",
      "description": "Turn any screen into a collaborative canvas. Free real-time whiteboard and screen annotation tool for remote teams.",
      "image": "https://codefrydev.in/CFDPenney/og-image.jpg",
      "brand": {
        "@type": "Brand",
        "name": "CodeFryDev"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD",
        "availability": "https://schema.org/InStock",
        "url": "https://codefrydev.in/CFDPenney/"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5",
        "ratingCount": "1",
        "reviewCount": "1",
        "bestRating": "5",
        "worstRating": "1"
      }
    }
    </script>
    
    <!-- HowTo Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "@id": "https://codefrydev.in/CFDPenney/#howto",
      "name": "How to Start Collaborating with CFD Penney",
      "description": "Learn how to start a collaborative annotation session with CFD Penney in three simple steps.",
      "image": "https://codefrydev.in/CFDPenney/og-image.jpg",
      "totalTime": "PT30S",
      "estimatedCost": {
        "@type": "MonetaryAmount",
        "currency": "USD",
        "value": "0"
      },
      "tool": {
        "@type": "HowToTool",
        "name": "CFD Penney Desktop App or Web Browser"
      },
      "step": [
        {
          "@type": "HowToStep",
          "position": 1,
          "name": "Start Session",
          "text": "Open the desktop app or web browser and click 'Host'. Your creative space is ready.",
          "url": "https://codefrydev.in/CFDPenney/#how-it-works"
        },
        {
          "@type": "HowToStep",
          "position": 2,
          "name": "Share Link",
          "text": "A unique session link is generated. Share the URL or just the 6-character code with your team.",
          "url": "https://codefrydev.in/CFDPenney/#how-it-works"
        },
        {
          "@type": "HowToStep",
          "position": 3,
          "name": "Annotate Together",
          "text": "Peers join instantly via the link. Everyone's cursor is visible. Draw, highlight, and solve problems together.",
          "url": "https://codefrydev.in/CFDPenney/#how-it-works"
        }
      ]
    }
    </script>
    
    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "@id": "https://codefrydev.in/CFDPenney/#breadcrumb",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://codefrydev.in/CFDPenney/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Web App",
          "item": "https://codefrydev.in/CFDPenney/canvas.html"
        }
      ]
    }
    </script>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-content">
            <!-- Logo -->
            <h1 class="nav-logo" onclick="window.scrollTo(0,0)">
                <span class="nav-logo-cfd">CFD</span>
                <span class="nav-logo-penney">Penney</span>
            </h1>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>

        <div class="container">
            <div class="text-center reveal">
                <div class="badge">
                    <div class="ping-dot">
                        <span class="ping-animate"></span>
                        <span class="ping-static"></span>
                    </div>
                    Now available on Windows, macOS & Linux
                </div>
                
                <h1 class="hero-title">
                    Turn any screen into a <br>
                    <span class="gradient-text">collaborative canvas.</span>
                </h1>
                
                <p class="hero-desc">
                    Host screen annotation sessions directly over your apps, or start a fresh whiteboard for brainstorming. 
                    Simple code-based joining via web or app. Totally free, no account clutter.
                </p>
                
                <div class="btn-group">
                    <button id="download-desktop-btn" class="btn-primary" style="text-decoration: none; border: none; cursor: pointer;">
                        <i class="fab fa-windows"></i> 
                        <i class="fab fa-apple"></i>
                        <i class="fab fa-linux"></i>
                        <span>Download for Desktop</span>
                    </button>
                    <a href="canvas.html" class="btn-secondary">
                        <i class="fas fa-globe" style="color:#94a3b8;"></i>
                        Open Web App
                    </a>
                </div>
            </div>

            <!-- Mockup -->
            <div class="mockup-container reveal">
                <div class="mockup-glow"></div>
                <div class="mockup-window">
                    <div class="mockup-header">
                        <div class="dots">
                            <div class="dot dot-red"></div>
                            <div class="dot dot-yellow"></div>
                            <div class="dot dot-green"></div>
                        </div>
                        <div class="url-bar">
                            Session ID: <span style="color:var(--brand-500); font-weight:bold;">CFD-8921</span>
                        </div>
                    </div>
                    
                    <div class="mockup-content">
                        <div class="grid-bg"></div>
                        
                        <div class="floating-window">
                            <div class="skeleton-line h-2 w-1-3 bg-700"></div>
                            <div class="skeleton-line h-2 w-2-3 bg-700"></div>
                            <div class="skeleton-line h-2 w-1-2 bg-700"></div>
                        </div>

                        <svg class="annotations-svg">
                            <!-- Arrow -->
                            <path d="M 300 200 Q 400 150 550 220" stroke="#f43f5e" stroke-width="4" fill="none" stroke-linecap="round" stroke-dasharray="10 5" class="animate-pulse"/>
                            <path d="M 550 220 L 530 215 M 550 220 L 540 200" stroke="#f43f5e" stroke-width="4" fill="none" stroke-linecap="round" />
                            
                            <!-- Circle -->
                            <ellipse cx="70%" cy="60%" rx="80" ry="40" stroke="#22d3ee" stroke-width="4" fill="none" transform="rotate(-10 70% 60%)" stroke-dasharray="400" stroke-dashoffset="0" />
                            
                            <!-- Cursor 1 -->
                            <g transform="translate(550, 220)">
                                <path d="M0 0L15 5L10 10L20 20L15 22L5 12L0 18Z" fill="#f43f5e"/>
                                <text x="10" y="35" fill="white" font-size="12" font-family="sans-serif" style="background:#0f172a; padding:0 4px;">Sarah (Web)</text>
                            </g>

                            <!-- Cursor 2 -->
                            <g transform="translate(300, 200)">
                                <path d="M0 0L15 5L10 10L20 20L15 22L5 12L0 18Z" fill="#22d3ee"/>
                                <text x="10" y="35" fill="white" font-size="12" font-family="sans-serif">Mike (Host)</text>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features-section">
        <div class="container">
            <div class="section-header reveal">
                <span class="overline">Two Distinct Modes</span>
                <h3 class="section-title">Collaborate Your Way</h3>
            </div>

            <div class="features-grid">
                <!-- Screen Annotation Mode -->
                <div class="feature-card-wrapper reveal">
                    <div class="card-glow glow-blue"></div>
                    <div class="feature-card">
                        <div class="feature-icon icon-blue">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h4 class="feature-title">Screen Annotation Mode</h4>
                        <p style="margin-bottom: 1rem; color: var(--slate-500);">Turn your actual desktop into a canvas.</p>
                        <ul class="feature-list">
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Draw over any app (CAD, IDEs, Browser).</span>
                            </li>
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Perfect for code reviews and tutorials.</span>
                            </li>
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Remote peers see your screen + drawings.</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Whiteboard Mode -->
                <div class="feature-card-wrapper reveal">
                    <div class="card-glow glow-teal"></div>
                    <div class="feature-card">
                        <div class="feature-icon icon-teal">
                            <i class="fas fa-chalkboard"></i>
                        </div>
                        <h4 class="feature-title">Virtual Whiteboard Mode</h4>
                        <p style="margin-bottom: 1rem; color: var(--slate-500);">A clean slate for fresh ideas.</p>
                        <ul class="feature-list">
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Infinite canvas for brainstorming.</span>
                            </li>
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Works locally even if server is offline.</span>
                            </li>
                            <li>
                                <i class="fas fa-check check-icon"></i>
                                <span>Works instantly in any web browser.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How it Works -->
    <section id="how-it-works" class="how-section">
        <div class="container">
            <div class="section-header reveal">
                <h3 class="section-title">Seamless Collaboration</h3>
                <p style="margin-top:1rem; color:var(--slate-600);">Start annotating in under 30 seconds.</p>
            </div>

            <div class="steps-grid">
                <!-- Step 1 -->
                <div class="step-card reveal">
                    <div class="step-number bg-step-1">1</div>
                    <h4 class="step-title">Start Session</h4>
                    <p class="step-desc">Open the desktop app or web browser and click "Host". Your creative space is ready.</p>
                </div>
                
                <!-- Step 2 -->
                <div class="step-card reveal">
                    <div class="step-number bg-step-2">2</div>
                    <h4 class="step-title">Share Link</h4>
                    <p class="step-desc">A unique session link is generated. Share the URL or just the 6-character code with your team.</p>
                    <div class="code-box" style="font-size: 0.75rem;">.../CFDPenney/?code=XRKXM</div>
                </div>

                <!-- Step 3 -->
                <div class="step-card reveal">
                    <div class="step-number bg-step-3">3</div>
                    <h4 class="step-title">Annotate Together</h4>
                    <p class="step-desc">Peers join instantly via the link. Everyone's cursor is visible. Draw, highlight, and solve problems together.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Join Session CTA -->
    <section class="cta-section">
        <div class="cta-blob cta-blob-1"></div>
        <div class="cta-blob cta-blob-2"></div>

        <div class="cta-content reveal">
            <h2 class="cta-title">Ready to jump in?</h2>
            <div class="join-card">
                <label class="join-label">JOIN AN EXISTING SESSION</label>
                <div class="join-form">
                    <input type="text" id="session-code-input" placeholder="Enter session code (e.g. XRKXM)" class="join-input">
                    <button id="join-submit-btn" class="join-btn">
                        Join
                    </button>
                </div>
                <p class="security-note">
                    <i class="fas fa-network-wired" style="margin-right:0.25rem;"></i> Powered by PeerJS & WebRTC. No login required for guests.
                    <br>
                    <span style="opacity: 0.7; font-size: 0.85em; display: inline-block; margin-top: 5px;">* Collaboration depends on public server availability, but you can use the whiteboard locally anytime.</span>
                </p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="download" class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <h2 class="footer-brand" style="cursor: pointer;" onclick="window.scrollTo(0,0)">
                        <span class="footer-name" style="color: var(--slate-900);">CFD</span>
                        <span class="footer-name" style="color: white; background: linear-gradient(to right, #f97316, #ea580c); padding: 0.125rem 0.375rem; transform: rotate(-2deg); display: inline-block; border-radius: 0.375rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-left: 0.25rem;">Penney</span>
                    </h2>
                    <p class="footer-desc">
                        Empowering remote teams with the most intuitive screen-sharing and annotation platform built for speed and clarity.
                    </p>
                </div>
                
                <div>
                    <h4 class="footer-heading">Product</h4>
                    <ul class="footer-links">
                        <li><a href="#" id="footer-download-link" style="cursor: pointer;">Download Desktop</a></li>
                        <li><a href="canvas.html">Web Client</a></li>
                        <li><a href="https://github.com/codefrydev/CFDPenney/" target="_blank">Source Code</a></li>
                        <li><a href="#">Free Forever</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-heading">Support</h4>
                    <ul class="footer-links">
                        <li><a href="#">Help Center</a></li>
                        <li><a href="llms.txt" target="_blank">Documentation (Summary)</a></li>
                        <li><a href="llms-full.txt" target="_blank">Full Documentation</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms & Conditions</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; <span id="current-year"></span> CodeFryDev. All rights reserved.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter" style="font-size:1.1rem;"></i></a>
                    <a href="https://github.com/codefrydev/CFDPenney/" target="_blank"><i class="fab fa-github" style="font-size:1.1rem;"></i></a>
                    <a href="#"><i class="fab fa-linkedin" style="font-size:1.1rem;"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Download Modal -->
    <div id="download-modal-overlay" class="download-modal-overlay" style="display: none;">
        <div id="download-modal" class="download-modal">
            <div class="download-modal-header">
                <h3 class="download-modal-title">Download Desktop App</h3>
                <button id="download-modal-close" class="download-modal-close" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="download-modal-content">
                <div id="download-version-info" class="download-version-info" style="display: none;">
                    Latest version: <span id="version-number">-</span>
                </div>
                <div class="download-platforms">
                    <button class="download-platform-btn" data-platform="windows" id="download-windows">
                        <div class="platform-icon">
                            <i class="fab fa-windows"></i>
                        </div>
                        <div class="platform-info">
                            <span class="platform-name">Windows</span>
                            <span class="platform-files">.exe installer</span>
                            <span class="platform-size" id="windows-size"></span>
                        </div>
                        <div class="download-arrow">
                            <i class="fas fa-download"></i>
                        </div>
                    </button>
                    <button class="download-platform-btn" data-platform="macos" id="download-macos">
                        <div class="platform-icon">
                            <i class="fab fa-apple"></i>
                        </div>
                        <div class="platform-info">
                            <span class="platform-name">macOS</span>
                            <span class="platform-files">.dmg disk image</span>
                            <span class="platform-size" id="macos-size"></span>
                        </div>
                        <div class="download-arrow">
                            <i class="fas fa-download"></i>
                        </div>
                    </button>
                    <button class="download-platform-btn" data-platform="linux" id="download-linux">
                        <div class="platform-icon">
                            <i class="fab fa-linux"></i>
                        </div>
                        <div class="platform-info">
                            <span class="platform-name">Linux</span>
                            <span class="platform-files">.AppImage & .deb</span>
                            <span class="platform-size" id="linux-size"></span>
                        </div>
                        <div class="download-arrow">
                            <i class="fas fa-download"></i>
                        </div>
                    </button>
                </div>
                <div id="download-loading" class="download-loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Fetching latest release...</span>
                </div>
                <div id="download-error" class="download-error" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Unable to fetch download links automatically. You can still download from GitHub. Compile your own version from the source code.</span>
                </div>
                <div class="download-fallback-link">
                    <a href="https://github.com/codefrydev/CFDPenney/releases" target="_blank">
                        <i class="fab fa-github"></i> View all releases on GitHub
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Set dynamic year
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // Scroll Reveal Animation
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.reveal').forEach((el) => {
            observer.observe(el);
        });

        // Join Session Logic
        const joinBtn = document.getElementById('join-submit-btn');
        const codeInput = document.getElementById('session-code-input');

        const handleJoin = () => {
            const code = codeInput.value.trim();
            if (code) {
                // Redirect to the actual app URL with the code parameter
                window.location.href = `canvas.html?code=${code}`;
            } else {
                alert('Please enter a valid session code.');
            }
        };

        joinBtn.addEventListener('click', handleJoin);
        
        // Allow pressing Enter to join
        codeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleJoin();
            }
        });

        // Download Modal Logic
        const downloadBtn = document.getElementById('download-desktop-btn');
        const downloadModal = document.getElementById('download-modal-overlay');
        const downloadModalClose = document.getElementById('download-modal-close');
        const downloadLoading = document.getElementById('download-loading');
        const downloadError = document.getElementById('download-error');
        const platformButtons = document.querySelectorAll('.download-platform-btn');
        const versionInfo = document.getElementById('download-version-info');
        const versionNumber = document.getElementById('version-number');

        let releaseData = null;
        let releaseAssets = null;

        // Detect user's platform
        function detectPlatform() {
            const userAgent = navigator.userAgent || navigator.platform || '';
            const platform = userAgent.toLowerCase();
            
            if (platform.includes('win')) return 'windows';
            if (platform.includes('mac')) return 'macos';
            if (platform.includes('linux') || platform.includes('x11')) return 'linux';
            return null;
        }

        // Format file size
        function formatFileSize(bytes) {
            if (!bytes) return '';
            const mb = bytes / (1024 * 1024);
            return `(${mb.toFixed(1)} MB)`;
        }

        // Open modal function
        const openDownloadModal = () => {
            downloadModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Highlight user's platform immediately
            const userPlatform = detectPlatform();
            if (userPlatform) {
                const recommendedBtn = document.querySelector(`[data-platform="${userPlatform}"]`);
                if (recommendedBtn && !recommendedBtn.classList.contains('recommended')) {
                    recommendedBtn.classList.add('recommended');
                }
            }
            
            // Fetch latest release if not already fetched
            if (!releaseAssets) {
                fetchLatestRelease();
            } else {
                // If already fetched, just update buttons
                updatePlatformButtons();
            }
        };

        // Open modal
        downloadBtn.addEventListener('click', openDownloadModal);
        
        // Footer download link
        const footerDownloadLink = document.getElementById('footer-download-link');
        if (footerDownloadLink) {
            footerDownloadLink.addEventListener('click', (e) => {
                e.preventDefault();
                openDownloadModal();
            });
        }

        // Close modal
        const closeDownloadModal = () => {
            downloadModal.style.display = 'none';
            document.body.style.overflow = '';
        };

        downloadModalClose.addEventListener('click', closeDownloadModal);
        downloadModal.addEventListener('click', (e) => {
            if (e.target === downloadModal) {
                closeDownloadModal();
            }
        });

        // Escape key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && downloadModal.style.display === 'flex') {
                closeDownloadModal();
            }
        });

        // Fetch latest release from GitHub API
        async function fetchLatestRelease() {
            downloadLoading.style.display = 'flex';
            downloadError.style.display = 'none';
            
            try {
                const response = await fetch('https://api.github.com/repos/codefrydev/CFDPenney/releases/latest', {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    // If 404, try getting all releases and use the first one
                    if (response.status === 404) {
                        const allReleases = await fetch('https://api.github.com/repos/codefrydev/CFDPenney/releases', {
                            headers: {
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        if (allReleases.ok) {
                            const releases = await allReleases.json();
                            if (releases.length > 0) {
                                releaseData = releases[0];
                                releaseAssets = releases[0].assets;
                            } else {
                                throw new Error('No releases found');
                            }
                        } else {
                            throw new Error('Failed to fetch releases');
                        }
                    } else {
                        throw new Error('Failed to fetch release');
                    }
                } else {
                    releaseData = await response.json();
                    releaseAssets = releaseData.assets;
                }
                
                // Update version info
                if (releaseData && releaseData.tag_name) {
                    versionNumber.textContent = releaseData.tag_name.replace(/^v/, '');
                    versionInfo.style.display = 'block';
                }
                
                // Update platform buttons with file sizes and enable them
                updatePlatformButtons();
                
                downloadLoading.style.display = 'none';
            } catch (error) {
                console.error('Error fetching release:', error);
                downloadLoading.style.display = 'none';
                downloadError.style.display = 'flex';
                
                // Still enable buttons with fallback to GitHub
                platformButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            }
        }

        // Update platform buttons with file info
        function updatePlatformButtons() {
            if (!releaseAssets) return;

            const platformMap = {
                windows: { id: 'windows-size', patterns: ['.exe', 'win', 'windows', 'nsis'], priority: ['.exe', 'nsis'] },
                macos: { id: 'macos-size', patterns: ['.dmg', 'mac', 'macos', 'darwin'], priority: ['.dmg'] },
                linux: { id: 'linux-size', patterns: ['.AppImage', '.deb', 'linux'], priority: ['.AppImage', '.deb'] }
            };

            Object.entries(platformMap).forEach(([platform, config]) => {
                const sizeElement = document.getElementById(config.id);
                let bestAsset = null;
                
                // First try to find by priority
                for (const priority of config.priority) {
                    bestAsset = releaseAssets.find(asset => 
                        asset.name.toLowerCase().includes(priority.toLowerCase())
                    );
                    if (bestAsset) break;
                }
                
                // Fallback to any matching pattern
                if (!bestAsset) {
                    for (const pattern of config.patterns) {
                        bestAsset = releaseAssets.find(asset => 
                            asset.name.toLowerCase().includes(pattern.toLowerCase())
                        );
                        if (bestAsset) break;
                    }
                }
                
                if (bestAsset && sizeElement) {
                    sizeElement.textContent = formatFileSize(bestAsset.size);
                }
            });

            // Highlight recommended platform
            const userPlatform = detectPlatform();
            if (userPlatform) {
                const recommendedBtn = document.querySelector(`[data-platform="${userPlatform}"]`);
                if (recommendedBtn) {
                    recommendedBtn.classList.add('recommended');
                }
            }
        }

        // Platform download handlers
        function findAsset(platform) {
            if (!releaseAssets) return null;
            
            const platformConfig = {
                windows: { patterns: ['.exe', 'win', 'windows', 'nsis'], priority: ['.exe', 'nsis'] },
                macos: { patterns: ['.dmg', 'mac', 'macos', 'darwin'], priority: ['.dmg'] },
                linux: { patterns: ['.AppImage', '.deb', 'linux'], priority: ['.AppImage', '.deb'] }
            };
            
            const config = platformConfig[platform];
            if (!config) return null;
            
            // First try priority patterns
            for (const priority of config.priority) {
                const asset = releaseAssets.find(a => 
                    a.name.toLowerCase().includes(priority.toLowerCase())
                );
                if (asset) return asset.browser_download_url;
            }
            
            // Fallback to any matching pattern
            for (const pattern of config.patterns) {
                const asset = releaseAssets.find(a => 
                    a.name.toLowerCase().includes(pattern.toLowerCase())
                );
                if (asset) return asset.browser_download_url;
            }
            
            return null;
        }

        platformButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const platform = btn.dataset.platform;
                const downloadUrl = findAsset(platform);
                
                // Add downloading state
                btn.classList.add('downloading');
                
                if (downloadUrl) {
                    // Start download
                    const link = document.createElement('a');
                    link.href = downloadUrl;
                    link.download = '';
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Close modal after a short delay
                    setTimeout(() => {
                        btn.classList.remove('downloading');
                        closeDownloadModal();
                    }, 800);
                } else {
                    // Fallback to GitHub releases page
                    window.open('https://github.com/codefrydev/CFDPenney/releases/latest', '_blank');
                    setTimeout(() => {
                        btn.classList.remove('downloading');
                        closeDownloadModal();
                    }, 500);
                }
            });
        });
    </script>
</body>
</html>